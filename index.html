<html>
<head>
<meta charset="utf-8">
<title>Isomorphic Musical Keyboards</title>
<link rel=stylesheet type="text/css" href="keyboard.css">
<script src="jquery.min.js"></script>
<script src="keyboard.js"></script>
<script src="notation.js"></script>
<script src="vexflow-min.js"></script>
<script>
var keyboard, notation, canvas, ctx, voice, stave; 

function parseQueryString(query){
	var vars = query.split("&");
	var obj = {}
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split("=");
        obj[pair[0]] = pair[1];
    }
    return obj;
}

function changeKeyboard(specString){
	var specs = parseQueryString(specString);
	keyboard = new Keyboard({
		el: $("#keyboard"), 
		system: specs.system, 
		startNote: specs.start,
		rows: parseInt(specs.rows),
		onClick: function(note){
			notation.draw(note);

			drawVexNote(note);

		}
	});
}

function drawVexNote(note){
	var renderer = new Vex.Flow.Renderer("note-canvas", Vex.Flow.Renderer.Backends.CANVAS);
	ctx = renderer.getContext();
	ctx.clear();

  	stave = new Vex.Flow.Stave(0, 0, 100);
  	stave.addClef("treble").setContext(ctx).draw();
	
    var vexNote = new Vex.Flow.StaveNote({ keys: [note.name+"/"+note.octave], duration: "w" })
    			
    if(note.name.charAt(1) == "b"){
		vexNote.addAccidental(0, new Vex.Flow.Accidental("b"))
    }
  	Vex.Flow.Formatter.FormatAndDraw(ctx, stave, [vexNote]);	
}

$(document).ready(function(){
	changeKeyboard($("select option:first").val());
});

function svgLoaded(){
	notation = new Notation({
		el: $("#noteDisplay"),
		width: 300
	});
}

</script>
</head>
<body>
<h1>Isomorphic Musical Keyboards</h1>

<p>Isomorphic musical keyboards must have been around ever since a lazy pianist decided that transposing between keys on the piano was too hard. Although they look alien to most people, compared to the piano keyboard, any of the isomorphic keyboards make more logical sense. The keyboard that made its furthest inroads into the piano world was the one pattented by Paul von Jank贸 in 1882 of which a fair number of examples can be found on the net. (See <a href="http://squeezehead.com/uniform-keyboard/">this</a>)</p>

<p>In the 20th century proponents of microtonality employed them to build instruments such as the Fokker 31 tone organ. Brian Hayden developed a concertina to use the Wicki system in the 60's that kept all the fingers playing a diatonic scale together. 

<p>But the most popular isomorphic keyboards have to be the ones used on accordions. The Stradella bass system is partly an isomorphic keyboard. On the treble side, the B chromatic system has replaced all other accordion keyboards in Russia and the Balkans, and the C system is widely used in Western Europe. The B system was invented in the 1850's when the Austrian musician Franz Walther had an idea to arrange a row of buttons to match the diminished chord. The Austrian Schrammel accordion was the first to use it. </p>

<p>These keyboards have also inspired a rethinking of music notation. The thinking is symilar: why not have every pattern of dots on the staff, regardless of its vertical position, mean the same thing musically? Similar to how guitar tablature notation evolved to fit the instrument layout, these notation systems follow the layout of the keyboard they're meant for. 

<p>IMportant limitatino is that on a piano keyboard, because each key is different, you must rearrange each transposition so that it sounds and feels good in that key. This results in new discoveries about the piece, and makes each transposition different. The isomorphic keyboard enouranges the same voicings which may not sound good in every regitser. 

<p>The fascinating thing is that all these systems can be built on a brick-like lattice with a simple algorithm. The variation between the systems can be boiled down to two parameters: (1) the number of rows required before the pattern repeats and (2) the size of the interval going up one key diagonally.

<h3>Available Keyboards</h3>

<select onchange="changeKeyboard(this.value)"> 
<option value='system=C&rows=5&start=gb3'>C-system 5 rows</option>
<option value='system=C&rows=4&start=gb3'>C-system 4 rows</option>
<option value='system=B&rows=4&start=b2'>B-system 4 rows</option>
<option value='system=B&rows=5&start=b2'>B-system 5 rows</option>
<option value='system=B&rows=6&start=b2'>B-system 6 rows</option>
<option value='system=S&rows=2&start=gb1'>Stradella root & counter-bass</option>
<option value='system=J&rows=2&start=c4'>Jank贸 2 rows</option>
<option value='system=J&rows=3&start=c4'>Jank贸 3 rows</option>
<option value='system=J&rows=4&start=c4'>Jank贸 4 rows</option>
<option value='system=W&rows=9&start=gb3'>Wicki-Hayden (Jammer) 9 rows</option>
<option value='system=F&rows=8&start=c0'>Aaron Copland would love me</option>
</select>

<label class='non-selectable'><input type='checkbox' onclick='keyboard.toggleNoteNames()' checked>Show note names</label>

<div id="keyboard"></div>

<object type="image/svg+xml" id="noteDisplay" data="notation/note_on_staff.svg" onload="svgLoaded()">Your browser does not support SVG</object>

<canvas id="note-canvas" width=700 height=300></canvas>



<h3>Todo:</h3>
<ul>
	<li>allow sharps as input
</ul>
<h3>Related:</h3>
<ul>
<li><a href="http://schrammelharmonika.nonfoodfactory.org/Andreas_Teufel/">Andreas Teufel's thesis</a> about the Vienese Schrammelharmonika.
<li><a href="http://www.shiverware.com/musix.html">Musix<a/> An iPhone app to build any isomorphic keyboard you can think of
<li><a href="http://en.wikipedia.org/wiki/Isomorphic_keyboard">Isomorphic Keyboard</a> Wikipedia
<li><a href="http://squeezehead.com/uniform-keyboard/">Uniform Keyboard</a> by Noel Cragg
<li><a href="http://www.thecipher.com/c_and_b_system_cba_spelling.html">The Cipher - B and C systems comparisons</a> by Roger Edward Blumberg
<li><a href="http://www.accordionpage.com/treble.html">Hans Palm's Accordion page</a>
</ul>
</body>

</html>
